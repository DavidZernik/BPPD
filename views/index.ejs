
      <!-- SEARCH BAR-->
      <div class="row">
        <div class="col-md-8 col-md-offset-2">
          <form>
            <div class="input-group">
              <input id="input-search" name="search" type="text" class="form-control input-lg" placeholder="Search Music">
              <span class="input-group-btn">
                <button id="btn-search" class="btn btn-primary btn-lg" type="submit"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
              </span>
            </div>
          </form>
          <div id="results">
          </div>
        </div>
      </div>
      <!-- END SEARCH BAR -->
      </div>

<!-- SEARCH SCRIPT -->
    <script>
      $(function(){
        var $input = $('#input-search');
        var $searchBtn = $('#btn-search');
        var $results = $('#results');

        var widgetIframe = null;

        $searchBtn.click(function(event){
          event.preventDefault();
          getASong($input.val());
        });

        function getASong(searchParams) {
          $.ajax({
              url: 'http://localhost:3000/api/search',
              contentType: "application/json; charset=utf-8",
              dataType: 'json',
              data: {searchString: searchParams},
              success: function(response){
                var results = response;
                var randResultNum = Math.round(Math.random() * (response.length -1));
                var randomSong = response[randResultNum];
                $('#results').slideUp("slow", function(){
                  $('.search-result').remove();
                  $results.append($('<div class="search-result"><iframe id="sc-current-song" class="soundcloud-embed" width="100%" height="166" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/' + randomSong + '&amp;color=18BC9C&amp;auto_play=true&amp;hide_related=false&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false"></iframe><button class="btn btn-add btn-default btn-lg" data-song-id="' + randomSong + '"><span id="favorite" class="glyphicon glyphicon-star-empty" aria-hidden="true"></span></button></div>'));
                  $('#results').slideDown("slow");
                  bindSCWidgetEvents('sc-current-song');
                  bindLikeBtn();
                })
              }
          });
        }

        function bindSCWidgetEvents(widgetID) {
          var nextSearchWords = [];
          var nextSearchParams = [];
          widgetIframe = document.getElementById(widgetID),
          widget       = SC.Widget(widgetIframe);

          widget.bind(SC.Widget.Events.READY, function() {
            
            widget.bind(SC.Widget.Events.PLAY, function() {
              widget.getCurrentSound(function(currentSound) {

                var title = currentSound.title.replace(/['"]+/g, '').split(' ');
                for(var i = 0; i < title.length; i ++) {
                  nextSearchWords.push(title[i]);
                }
                
                if(currentSound.genre) {
                  nextSearchWords.push(currentSound.genre);
                }
                if(currentSound.tag_list.length > 0 && (currentSound.tag_list.indexOf(':source') == -1)) {
                  var tagList = currentSound.tag_list.replace(/['"]+/g, '').split(' ');
                  for(var i = 0; i < tagList.length; i ++) {
                    nextSearchWords.push(tagList[i]);
                  }
                }
                
                console.log(nextSearchWords);
                console.log('contains the phrase :source: ' + currentSound.tag_list.indexOf(':source'))
                var nextSearchParam1 = nextSearchWords.splice(Math.round(Math.random() * (nextSearchWords.length - 1)), 1).join();
                nextSearchParams.push(nextSearchParam1);
                var nextSearchParam2 = nextSearchWords.splice(Math.round(Math.random() * (nextSearchWords.length - 1)), 1).join();
                nextSearchParams.push(nextSearchParam2)
                console.log(nextSearchParams);
                //console.log(nextSearchWords);
              });
            });
            widget.bind(SC.Widget.Events.FINISH, function(){
              widget.getCurrentSound(function(currentSound){
                //console.log(currentSound.title + ' just finished.');
                //console.log(nextSearchWords)
                getASong(nextSearchParams.join(' '));
              });
            })
          });
        }


        function bindLikeBtn() {
          var $addBtn = $('.btn-add');
          var $songId = $addBtn.data('song-id'); // will grab from below sound cloud code
          $addBtn.click(function(event){
            event.preventDefault();
            console.log('song to add:', $songId);
            $.ajax({
              url: '/users/addsong/' + $songId,
              success: function(response){
                if(response.results){
                  console.log(response.results + ' your song has been added');
                }else{
                  console.log(response.results + ' your song has been removed');
                }
                $('.btn-add').toggleClass('btn-default').toggleClass('btn-success').blur();
                $('.btn-add span').toggleClass('glyphicon-star-empty').toggleClass('glyphicon-star')
              }
            })
          });
        }

      })
    </script>
<!-- END SEARCH SCRIPT -->
